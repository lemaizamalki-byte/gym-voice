<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gym Voice</title>

<style>
body {
  margin: 0;
  height: 100vh;
  background: #0b132b;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: system-ui;
  color: white;
}

#mic {
  width: 160px;
  height: 160px;
  border-radius: 50%;
  background: #22c55e;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 64px;
}

#mic.recording {
  background: #ef4444;
}

#status {
  margin-top: 20px;
  font-size: 16px;
  opacity: 0.9;
}

#audios {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: rgba(0,0,0,0.4);
  padding: 10px;
}
</style>
</head>

<body>

<div id="mic">üèãÔ∏è</div>
<div id="status">Mant√©n pulsado para grabar</div>
<div id="audios"></div>

<script>
let mediaRecorder;
let chunks = [];
let stream;

const mic = document.getElementById("mic");
const status = document.getElementById("status");
const audios = document.getElementById("audios");

let recordings = JSON.parse(localStorage.getItem("gymAudios")) || [];

function renderAudios() {
  audios.innerHTML = recordings
    .slice(-5)
    .reverse()
    .map(r => `
      <div>
        üóì ${new Date(r.date).toLocaleString()}
        <audio controls src="${r.url}"></audio>
      </div>
    `).join("");
}
renderAudios();

mic.addEventListener("touchstart", async () => {
  if (mediaRecorder) return;

  stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  chunks = [];

  mediaRecorder.ondataavailable = e => chunks.push(e.data);

  mediaRecorder.onstop = () => {
    const blob = new Blob(chunks, { type: "audio/webm" });
    const url = URL.createObjectURL(blob);

    recordings.push({
      date: new Date().toISOString(),
      url
    });

    localStorage.setItem("gymAudios", JSON.stringify(recordings));
    renderAudios();

    status.textContent = "‚úÖ Audio guardado";
    mediaRecorder = null;
    stream.getTracks().forEach(t => t.stop());
  };

  mediaRecorder.start();
  mic.classList.add("recording");
  status.textContent = "üéôÔ∏è Grabando‚Ä¶";
});

mic.addEventListener("touchend", () => {
  if (!mediaRecorder) return;
  mediaRecorder.stop();
  mic.classList.remove("recording");
  status.textContent = "‚è≥ Guardando‚Ä¶";
});
</script>

</body>
</html>
