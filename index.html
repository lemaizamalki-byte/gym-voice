<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gym Voice</title>

<style>
* {
  -webkit-user-select: none;
  user-select: none;
}

body {
  margin: 0;
  height: 100vh;
  background: #0b132b;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  font-family: system-ui;
}

#mic {
  width: 160px;
  height: 160px;
  border-radius: 50%;
  background: #22c55e;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 64px;
}

#mic.recording {
  background: #ef4444;
}

#status {
  margin-top: 20px;
  font-size: 16px;
  opacity: 0.9;
}

#notes {
  position: fixed;
  bottom: 0;
  width: 100%;
  max-height: 35%;
  overflow-y: auto;
  background: rgba(0,0,0,0.4);
  padding: 12px;
  box-sizing: border-box;
}

.note {
  font-size: 14px;
  margin-bottom: 6px;
  opacity: 0.85;
}
</style>
</head>

<body>

<div id="mic">üèãÔ∏è</div>
<div id="status">Mant√©n pulsado para hablar</div>
<div id="notes"></div>

<script>
const SpeechRecognition = window.webkitSpeechRecognition;
const mic = document.getElementById("mic");
const status = document.getElementById("status");
const notesBox = document.getElementById("notes");

let recognition;
let recording = false;
let startTime = 0;

let log = JSON.parse(localStorage.getItem("gymLog")) || [];

function getWeek(date) {
  const d = new Date(date);
  d.setHours(0,0,0,0);
  d.setDate(d.getDate() + 3 - (d.getDay() + 6) % 7);
  const week1 = new Date(d.getFullYear(),0,4);
  return d.getFullYear() + "-W" +
    String(1 + Math.round(((d - week1) / 86400000 - 3 + (week1.getDay()+6)%7) / 7)).padStart(2,"0");
}

function renderNotes() {
  notesBox.innerHTML = log
    .slice(-10)
    .reverse()
    .map(n => `<div class="note">üóì ${n.week} ¬∑ ${n.text}</div>`)
    .join("");
}

renderNotes();

mic.addEventListener("touchstart", () => {
  if (!SpeechRecognition || recording) return;

  recognition = new SpeechRecognition();
  recognition.lang = "es-ES";
  recognition.interimResults = false;
  recognition.continuous = false;

  startTime = Date.now();
  recording = true;
  mic.classList.add("recording");
  status.textContent = "üéôÔ∏è Escuchando‚Ä¶";

  recognition.start();

  recognition.onresult = (e) => {
    const text = e.results[0][0].transcript;
    const duration = Math.round((Date.now() - startTime) / 1000);
    const date = new Date().toISOString();

    log.push({
      id: Date.now(),
      date,
      week: getWeek(date),
      duration,
      text
    });

    localStorage.setItem("gymLog", JSON.stringify(log));
    renderNotes();

    status.textContent = "‚úÖ Guardado";
  };

  recognition.onerror = () => {
    status.textContent = "‚ùå Error de voz";
  };

  recognition.onend = () => {
    recording = false;
    mic.classList.remove("recording");
  };
});

mic.addEventListener("touchend", () => {
  if (recording && recognition) {
    recognition.stop();
  }
});
</script>

</body>
</html>
