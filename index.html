<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gym Voice</title>

<style>
* {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

body {
  margin: 0;
  height: 100vh;
  background: #0b132b;
  font-family: system-ui;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

#mic {
  width: 170px;
  height: 170px;
  border-radius: 50%;
  background: #22c55e;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 64px;
}

#mic.recording {
  background: #ef4444;
}

#status {
  margin-top: 20px;
  font-size: 16px;
}

#notes {
  position: fixed;
  bottom: 0;
  width: 100%;
  max-height: 35%;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(8px);
  padding: 12px;
  overflow-y: auto;
  font-size: 14px;
}
.note {
  opacity: 0.85;
  margin-bottom: 6px;
}
</style>
</head>

<body>

<div id="mic">üèãÔ∏è</div>
<div id="status">Mant√©n pulsado para hablar</div>

<div id="notes"></div>

<script>
const SpeechRecognition = window.webkitSpeechRecognition;
const mic = document.getElementById("mic");
const status = document.getElementById("status");
const notesBox = document.getElementById("notes");

let recognition;
let recording = false;
let safetyTimeout;

let log = JSON.parse(localStorage.getItem("gymLog")) || [];

function renderNotes() {
  notesBox.innerHTML = log
    .slice(-20)
    .reverse()
    .map(n => `<div class="note">‚Ä¢ ${n.text}</div>`)
    .join("");
}

renderNotes();

function startRec() {
  if (!SpeechRecognition) {
    status.textContent = "‚ùå Voz no soportada";
    return;
  }

  recognition = new SpeechRecognition();
  recognition.lang = "es-ES";
  recognition.interimResults = false;
  recognition.continuous = false;

  recognition.onresult = e => {
    const text = e.results[0][0].transcript;
    log.push({ date: Date.now(), text });
    localStorage.setItem("gymLog", JSON.stringify(log));
    status.textContent = "‚úÖ Guardado";
    renderNotes();
  };

  recognition.onerror = () => {
    status.textContent = "‚ùå Error de voz";
  };

  recognition.onend = () => {
    clearTimeout(safetyTimeout);
    recording = false;
    mic.classList.remove("recording");
  };

  recognition.start();

  safetyTimeout = setTimeout(() => {
    recognition.stop();
    status.textContent = "‚èπÔ∏è Sin voz detectada";
  }, 6000);
}

mic.addEventListener("touchstart", e => {
  e.preventDefault();
  if (recording) return;
  recording = true;
  mic.classList.add("recording");
  status.textContent = "üéôÔ∏è Escuchando‚Ä¶";
  startRec();
});

mic.addEventListener("touchend", e => {
  e.preventDefault();
  if (!recording) return;
  recognition.stop();
  status.textContent = "‚è≥ Procesando‚Ä¶";
});
</script>

</body>
</html>

