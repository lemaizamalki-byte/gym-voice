<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gym Voice</title>

<style>
* {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

body {
  margin: 0;
  height: 100vh;
  background: #0b132b;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: system-ui;
  color: white;
}

#mic {
  width: 170px;
  height: 170px;
  border-radius: 50%;
  background: #22c55e;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 64px;
  box-shadow: 0 0 40px rgba(34,197,94,.6);
}

#mic.recording {
  background: #ef4444;
  box-shadow: 0 0 40px rgba(239,68,68,.7);
}

#status {
  margin-top: 20px;
  font-size: 16px;
  opacity: 0.9;
}

#notes {
  position: fixed;
  bottom: 0;
  width: 100%;
  max-height: 35%;
  background: rgba(255,255,255,0.05);
  padding: 12px;
  overflow-y: auto;
  font-size: 14px;
}

.note {
  margin-bottom: 6px;
  opacity: 0.85;
}
</style>
</head>

<body>

<div id="mic">üèãÔ∏è</div>
<div id="status">Mant√©n pulsado para hablar</div>
<div id="notes"></div>

<script>
const SpeechRecognition = window.webkitSpeechRecognition;

const mic = document.getElementById("mic");
const status = document.getElementById("status");
const notesBox = document.getElementById("notes");

if (!SpeechRecognition) {
  status.textContent = "‚ùå Safari no soporta reconocimiento de voz";
}

let recognition;
let recording = false;

let log = JSON.parse(localStorage.getItem("gymLog")) || [];

function renderNotes() {
  notesBox.innerHTML = log
    .slice(-20)
    .reverse()
    .map(n => `<div class="note">‚Ä¢ ${n.text}</div>`)
    .join("");
}

renderNotes();

/* INICIAR AL MANTENER PULSADO */
mic.addEventListener("touchstart", (e) => {
  e.preventDefault();
  if (recording) return;

  recognition = new SpeechRecognition();
  recognition.lang = "es-ES";
  recognition.continuous = false;
  recognition.interimResults = false;

  recording = true;
  mic.classList.add("recording");
  status.textContent = "üéôÔ∏è Escuchando‚Ä¶";

  recognition.start();

  recognition.onresult = (e) => {
    const text = e.results[0][0].transcript.toLowerCase();

    log.push({
      text,
      date: new Date().toISOString()
    });

    localStorage.setItem("gymLog", JSON.stringify(log));
    renderNotes();

    status.textContent = "‚úÖ Guardado";
  };

  recognition.onerror = () => {
    status.textContent = "‚ùå Error con el micr√≥fono";
    recording = false;
    mic.classList.remove("recording");
  };
});

/* PARAR AL SOLTAR */
mic.addEventListener("touchend", () => {
  if (!recording) return;

  recording = false;
  mic.classList.remove("recording");
  status.textContent = "‚è≥ Procesando‚Ä¶";

  recognition.stop();
});
</script>

</body>
</html>
