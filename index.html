<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gym Voice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  height: 100vh;
  background: #0f172a;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  font-family: system-ui;
  color: white;
}

.center {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

#mic {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  background: #22c55e;
  border: none;
  font-size: 60px;
  box-shadow: 0 0 30px rgba(34,197,94,0.6);
}

#mic.recording {
  background: #ef4444;
  box-shadow: 0 0 30px rgba(239,68,68,0.6);
}

#status {
  text-align: center;
  margin-bottom: 10px;
}

#summary {
  width: 100%;
  background: #020617;
  padding: 16px;
  font-size: 14px;
}
</style>
</head>

<body>

<div class="center">
  <button id="mic">üèãÔ∏è‚Äç‚ôÇÔ∏è</button>
</div>

<div id="status">Mant√©n pulsado para hablar</div>

<div id="summary"></div>

<script>
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  document.getElementById("status").textContent =
    "‚ùå Safari no soporta reconocimiento de voz aqu√≠";
}

const recognition = new SpeechRecognition();
recognition.lang = "es-ES";
recognition.continuous = false;
recognition.interimResults = false;

let log = JSON.parse(localStorage.getItem("trainLog")) || [];

const mic = document.getElementById("mic");
const status = document.getElementById("status");
const summary = document.getElementById("summary");

mic.addEventListener("touchstart", () => {
  mic.classList.add("recording");
  status.textContent = "üéôÔ∏è Escuchando...";
  recognition.start();
});

mic.addEventListener("touchend", () => {
  mic.classList.remove("recording");
  recognition.stop();
});

recognition.onresult = (e) => {
  const text = e.results[0][0].transcript.toLowerCase();

  const entry = parseTraining(text);
  log.push(entry);
  localStorage.setItem("trainLog", JSON.stringify(log));

  status.textContent = "‚úÖ Guardado: " + entry.exercise;
  updateSummary();
};

recognition.onerror = () => {
  status.textContent = "‚ùå Error con el micr√≥fono";
};

function parseTraining(text) {
  const w = text.match(/(\d+(\.\d+)?)\s?(kg|kilos?)/);
  const r = text.match(/(\d+)\s?(reps?|repeticiones?)/);

  return {
    date: new Date().toISOString(),
    exercise: text.replace(/(\d+.*)/g,"").trim(),
    weight: w ? parseFloat(w[1]) : null,
    reps: r ? parseInt(r[1]) : null
  };
}

function updateSummary() {
  if (log.length < 2) {
    summary.textContent = "A√∫n no hay suficientes datos.";
    return;
  }

  const last = log[log.length - 1];
  const prev = log[log.length - 2];

  let msg = "üìä √öltimo registro:\n";
  msg += `${last.exercise} ‚Äî ${last.weight || "?"}kg x ${last.reps || "?"}\n`;

  if (last.weight && prev.weight && last.weight > prev.weight) {
    msg += "‚úÖ Progreso en peso\n";
  }

  if (last.reps && prev.reps && last.reps > prev.reps) {
    msg += "‚úÖ Progreso en repeticiones\n";
  }

  summary.textContent = msg;
}

updateSummary();
</script>

</body>
</html>
