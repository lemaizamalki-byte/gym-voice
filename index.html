<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gym Voice</title>

<style>
* {
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  user-select: none;
}

body {
  margin: 0;
  height: 100vh;
  background: #0b132b;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: system-ui;
  color: white;
}

#mic {
  width: 170px;
  height: 170px;
  border-radius: 50%;
  background: #22c55e;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 64px;
  box-shadow: 0 0 40px rgba(34,197,94,0.6);
  transition: 0.2s;
}

#mic.recording {
  background: #ef4444;
  box-shadow: 0 0 40px rgba(239,68,68,0.8);
}

#status {
  margin-top: 20px;
  font-size: 16px;
  opacity: 0.9;
}

#log {
  margin-top: 10px;
  font-size: 14px;
  opacity: 0.7;
  text-align: center;
  max-width: 80%;
}
</style>
</head>

<body>

<div id="mic">üèãÔ∏è</div>
<div id="status">Mant√©n pulsado para hablar</div>
<div id="log"></div>

<script>
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const mic = document.getElementById("mic");
const status = document.getElementById("status");
const logBox = document.getElementById("log");

if (!SpeechRecognition) {
  status.textContent = "‚ùå Safari no soporta voz en este dispositivo";
  throw new Error();
}

const recognition = new SpeechRecognition();
recognition.lang = "es-ES";
recognition.interimResults = false;
recognition.continuous = false;

let listening = false;
let history = JSON.parse(localStorage.getItem("gymLog")) || [];

function startListening() {
  if (listening) return;
  listening = true;
  mic.classList.add("recording");
  status.textContent = "üéôÔ∏è Escuchando‚Ä¶ suelta para guardar";

  try {
    recognition.start();
  } catch (e) {}
}

function stopListening() {
  if (!listening) return;
  listening = false;
  mic.classList.remove("recording");
  status.textContent = "‚è≥ Procesando‚Ä¶";
  recognition.stop();
}

mic.addEventListener("touchstart", (e) => {
  e.preventDefault();
  startListening();
});

mic.addEventListener("touchend", (e) => {
  e.preventDefault();
  stopListening();
});

recognition.onresult = (e) => {
  const text = e.results[0][0].transcript;

  history.push({
    date: new Date().toISOString(),
    text
  });

  localStorage.setItem("gymLog", JSON.stringify(history));

  status.textContent = "‚úÖ Guardado";
  logBox.textContent = text;
};

recognition.onerror = () => {
  status.textContent = "‚ùå No se pudo usar el micr√≥fono";
  mic.classList.remove("recording");
  listening = false;
};
</script>

</body>
</html>
